<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Id$
-->
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:pipeline="http://cocoon.apache.org/schema/pipeline"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://cocoon.apache.org/schema/pipeline http://cocoon.apache.org/schema/pipeline/cocoon-pipeline-1.0.xsd">


    <bean id="org.apache.cocoon.caching.Cache" class="org.apache.cocoon.caching.impl.CacheImpl">
        <property name="store" ref="org.apache.excalibur.store.Store"/>
    </bean>

    <bean name="org.apache.excalibur.store.Store"
        class="org.apache.cocoon.components.store.impl.EHDefaultStore" init-method="init"
        destroy-method="destroy">
        <property name="maxMemObjects" value="1000"/>
        <property name="overflowToDisk" value="false"/>
        <property name="useCacheDirectory" value="true"/>
        <property name="settings" ref="org.apache.cocoon.configuration.Settings"/>
    </bean>

    <bean name="org.apache.excalibur.store.Store/TransientStore"
        class="edu.stanford.irt.laneweb.store.TransientStore">
        <property name="storeJanitor" ref="org.apache.excalibur.store.StoreJanitor"/>
    </bean>

    <bean id="org.apache.excalibur.store.StoreJanitor"
        class="edu.stanford.irt.laneweb.store.StoreJanitorImpl"/>

    <bean name="org.apache.excalibur.xml.xpath.XPathProcessor"
        class="edu.stanford.irt.laneweb.cocoon.XPathProcessorImpl"/>

    <bean id="org.apache.commons.httpclient.HttpClient"
        class="org.apache.commons.httpclient.HttpClient">
        <constructor-arg>
            <bean class="edu.stanford.irt.laneweb.httpclient.ConnectionManager">
                <property name="maxTotalConnections" value="30"/>
                <property name="defaultMaxConnectionsPerHost" value="10"/>
                <property name="connectionTimeout" value="20000"/>
            </bean>
        </constructor-arg>
    </bean>

    <bean name="org.apache.excalibur.source.SourceFactory/http"
        class="edu.stanford.irt.laneweb.httpclient.HTTPClientSourceFactory">
        <property name="httpClient" ref="org.apache.commons.httpclient.HttpClient"/>
    </bean>

    <bean id="edu.stanford.irt.laneweb.ldap.LDAPDataAccess"
        class="edu.stanford.irt.laneweb.ldap.LDAPDataAccess">
        <property name="subjectSource">
            <bean class="edu.stanford.irt.laneweb.ldap.SubjectSource">
                <property name="name" value="IRT_K5"/>
            </bean>
        </property>
        <property name="ldapTemplate">
            <bean class="org.springframework.ldap.core.LdapTemplate">
                <constructor-arg>
                    <bean class="org.springframework.ldap.core.support.LdapContextSource">
                        <property name="url" value="ldap://ldap.stanford.edu/"/>
                        <property name="base" value="cn=people,dc=stanford,dc=edu"/>
                        <property name="authenticationStrategy">
                            <bean class="edu.stanford.irt.laneweb.ldap.GSSAPIAuthenticationStrategy"
                            />
                        </property>
                        <property name="baseEnvironmentProperties">
                            <map>
                                <entry key="com.sun.jndi.ldap.connect.timeout" value="5000"/>
                            </map>
                        </property>
                    </bean>
                </constructor-arg>
            </bean>
        </property>
    </bean>

    <bean name="org.apache.cocoon.generation.Generator/file"
        class="edu.stanford.irt.laneweb.cocoon.URLGenerator" scope="prototype">
        <property name="model" ref="edu.stanford.irt.laneweb.model.Model"/>
        <property name="parser" ref="org.apache.cocoon.core.xml.SAXParser"/>
    </bean>

    <bean name="org.apache.cocoon.generation.Generator/html"
        class="edu.stanford.irt.laneweb.cocoon.HTMLGenerator" scope="prototype"/>

    <bean name="org.apache.cocoon.generation.Generator/link-scan"
        class="edu.stanford.irt.laneweb.eresources.LinkScanGenerator" scope="prototype">
        <property name="dataSource" ref="javax.sql.DataSource/eresources"/>
    </bean>

    <bean name="org.apache.cocoon.generation.Generator/spellcheck"
        class="edu.stanford.irt.laneweb.spellcheck.SpellCheckGenerator"
        parent="edu.stanford.irt.laneweb.model.DefaultModelAware">
        <property name="spellChecker">
            <bean class="edu.stanford.irt.spell.GoogleToolbarSpellChecker"/>
        </property>
    </bean>

    <bean name="org.apache.cocoon.generation.Generator/directory"
        class="org.apache.cocoon.generation.DirectoryGenerator" scope="prototype"/>

    <bean name="org.apache.cocoon.transformation.Transformer/namespace-filter"
        class="edu.stanford.irt.laneweb.cocoon.NamespaceFilter" scope="prototype"/>

    <bean name="org.apache.cocoon.transformation.Transformer/xinclude"
        class="edu.stanford.irt.laneweb.cocoon.LanewebXIncludeTransformer" scope="prototype">
        <property name="parser" ref="org.apache.cocoon.core.xml.SAXParser"/>
        <property name="serviceManager" ref="org.apache.avalon.framework.service.ServiceManager"/>
    </bean>

    <bean name="org.apache.cocoon.reading.Reader/resource"
        class="edu.stanford.irt.laneweb.cocoon.NoCacheBigReader" scope="prototype"/>

    <bean name="org.apache.cocoon.reading.Reader/txt-resource"
        class="edu.stanford.irt.laneweb.cocoon.TxtResourceReader"
        parent="edu.stanford.irt.laneweb.model.DefaultModelAware">
        <property name="defaultPath" value="/"/>
        <property name="valueToSubstitute" value="/\./\."/>
        <!-- uses regex so /./. is what is actually substituted -->
    </bean>

    <bean name="org.apache.cocoon.acting.Action/voyager"
        class="edu.stanford.irt.laneweb.voyager.VoyagerAction" scope="prototype">
        <property name="model" ref="edu.stanford.irt.laneweb.model.Model"/>
        <property name="voyagerLogin">
            <bean class="edu.stanford.irt.laneweb.voyager.VoyagerLogin">
                <property name="dataSource" ref="javax.sql.DataSource/voyager"/>
            </bean>
        </property>
    </bean>

    <bean name="org.apache.cocoon.acting.Action/webdash"
        class="edu.stanford.irt.laneweb.webdash.WebdashAction" scope="prototype">
        <property name="model" ref="edu.stanford.irt.laneweb.model.Model"/>
        <property name="webdashLogin">
            <bean class="edu.stanford.irt.laneweb.webdash.WebdashLogin">
                <property name="webdashKey">
                    <bean class="org.springframework.jndi.JndiObjectFactoryBean">
                        <property name="jndiName" value="java:comp/env/webdash-key"/>
                    </bean>
                </property>
            </bean>
        </property>
    </bean>

    <bean name="org.apache.cocoon.acting.Action/invalidate-session"
        class="org.apache.cocoon.acting.SessionInvalidatorAction"/>

    <bean name="org.apache.cocoon.serialization.Serializer/xhtml"
        class="edu.stanford.irt.laneweb.cocoon.XHTMLSerializer" scope="prototype"
        parent="org.apache.cocoon.serialization.AbstractTextSerializer">
        <pipeline:component mime-type="text/html"/>
        <property name="format">
            <props>
                <prop key="doctype-public">-//W3C//DTD XHTML 1.0 Strict//EN</prop>
                <prop key="doctype-system">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</prop>
                <prop key="encoding">UTF-8</prop>
                <prop key="indent">yes</prop>
                <prop key="omit-xml-declaration">yes</prop>
            </props>
        </property>
        <property name="transformerFactory" value="net.sf.saxon.TransformerFactoryImpl"/>
    </bean>

    <bean name="org.apache.cocoon.serialization.Serializer/text"
        class="org.apache.cocoon.serialization.TextSerializer" scope="prototype"
        parent="org.apache.cocoon.serialization.AbstractTextSerializer">
        <pipeline:component mime-type="text/plain"/>
    </bean>

    <bean name="org.apache.cocoon.transformation.Transformer/saxon"
        class="edu.stanford.irt.laneweb.cocoon.LanewebTraxTransformer" scope="prototype">
        <property name="model" ref="edu.stanford.irt.laneweb.model.Model"/>
        <property name="xsltProcessor" ref="org.apache.excalibur.xml.xslt.XSLTProcessor/saxon"/>
    </bean>
    
    <bean name="org.apache.cocoon.transformation.Transformer/joost"
        class="edu.stanford.irt.laneweb.cocoon.LanewebTraxTransformer" scope="prototype">
        <property name="model" ref="edu.stanford.irt.laneweb.model.Model"/>
        <property name="xsltProcessor" ref="org.apache.excalibur.xml.xslt.XSLTProcessor/joost"/>
    </bean>

    <bean name="org.apache.cocoon.generation.Generator/&lt;aggregator&gt;"
    class="org.apache.cocoon.sitemap.DefaultContentAggregator" scope="prototype"/>
    
    <bean name="org.apache.cocoon.components.pipeline.ProcessingPipeline/noncaching"
        class="edu.stanford.irt.laneweb.cocoon.pipeline.NonCachingPipeline"
        scope="prototype">
    </bean>
    
    <bean name="org.apache.cocoon.components.pipeline.ProcessingPipeline/expires"
        class="edu.stanford.irt.laneweb.cocoon.pipeline.ExpiresCachingPipeline"
        scope="prototype">
        <property name="cache" ref="org.apache.cocoon.caching.Cache"/>
        <property name="cacheExpires" value="300"/>
    </bean>
    
    <bean name="org.apache.cocoon.components.pipeline.ProcessingPipeline/throttling"
        class="edu.stanford.irt.laneweb.cocoon.pipeline.ThrottlingPipeline"
        scope="prototype">
    </bean>
    
    <bean name="org.apache.cocoon.components.pipeline.ProcessingPipeline/caching"
        class="edu.stanford.irt.laneweb.cocoon.pipeline.CachingPipeline"
        scope="prototype">
        <property name="cache" ref="org.apache.cocoon.caching.Cache"/>
    </bean>
    
    <bean name="org.apache.excalibur.xml.xslt.XSLTProcessor/saxon"
        class="edu.stanford.irt.laneweb.cocoon.XSLTProcessorImpl"
        scope="prototype">
        <constructor-arg ref="org.apache.excalibur.xmlizer.XMLizer"/>
        <constructor-arg ref="org.apache.excalibur.store.Store/TransientStore"/>
        <constructor-arg ref="org.apache.excalibur.source.SourceResolver"/>
        <property name="transformerFactory" value="net.sf.saxon.TransformerFactoryImpl"/>
    </bean>
    
    <bean name="org.apache.excalibur.xml.xslt.XSLTProcessor/joost"
        class="edu.stanford.irt.laneweb.cocoon.XSLTProcessorImpl"
        scope="prototype">
        <constructor-arg ref="org.apache.excalibur.xmlizer.XMLizer"/>
        <constructor-arg ref="org.apache.excalibur.store.Store/TransientStore"/>
        <constructor-arg ref="org.apache.excalibur.source.SourceResolver"/>
        <property name="transformerFactory" value="net.sf.joost.trax.TransformerFactoryImpl"/>
    </bean>
    
    <bean id="org.apache.excalibur.xmlizer.XMLizer"
        class="edu.stanford.irt.laneweb.cocoon.LanewebXMLizer"/>

</beans>

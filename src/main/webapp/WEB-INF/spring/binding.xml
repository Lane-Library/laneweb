<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.2.xsd">
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder"
        class="edu.stanford.irt.laneweb.servlet.binding.CompositeDataBinder">
        <constructor-arg>
            <list>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/user"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/ticket"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/debug"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/remote-proxy-ip"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/template"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/emrid"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/request-parameter"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/request-method"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/request-header"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/user-cookie"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/base-path"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/content-base"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/version"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/disaster-mode"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/live-chat-schedule"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/bookmark"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/todays-hours"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/parameter-map"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/base-proxy-url"/>
                <ref bean="edu.stanford.irt.laneweb.servlet.binding.DataBinder/model"/>
            </list>
        </constructor-arg>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/model"
        class="edu.stanford.irt.laneweb.servlet.binding.ModelDataBinder">
        <constructor-arg>
            <set>
                <value>auth</value>
                <value>base-path</value>
                <value>disaster-mode</value>
                <value>isActiveSunetID</value>
                <value>ipgroup</value>
                <value>proxy-links</value>
                <value>url-encoded-query</value>
                <value>url-encoded-source</value>
            </set>
        </constructor-arg>
        <constructor-arg ref="com.fasterxml.jackson.databind.ObjectMapper"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/user"
        class="edu.stanford.irt.laneweb.servlet.binding.UserDataBinder">
        <constructor-arg>
            <list>
                <bean class="edu.stanford.irt.laneweb.servlet.binding.user.RequestAttributeUserFactory">
                    <constructor-arg value="%{edu.stanford.irt.laneweb.useridhashkey}"/>
                </bean>
                <bean class="edu.stanford.irt.laneweb.servlet.binding.user.CookieUserFactory">
                    <constructor-arg ref="edu.stanford.irt.laneweb.codec.UserCookieCodec"/>
                    <constructor-arg value="%{edu.stanford.irt.laneweb.useridhashkey}"/>
                </bean>
            </list>
        </constructor-arg>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/base-proxy-url"
        class="edu.stanford.irt.laneweb.servlet.binding.BaseProxyURLDataBinder"/>

    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/ticket"
        class="edu.stanford.irt.laneweb.servlet.binding.TicketDataBinder">
        <constructor-arg value="%{edu.stanford.irt.laneweb.ezproxy-key}"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/debug"
        class="edu.stanford.irt.laneweb.servlet.binding.BooleanSessionParameterDataBinder">
        <constructor-arg value="debug"/>
        <constructor-arg value="debug"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/ldap"
        class="edu.stanford.irt.laneweb.servlet.binding.LDAPDataBinder">
        <constructor-arg ref="edu.stanford.irt.laneweb.user.LDAPDataAccess"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/remote-proxy-ip"
        class="edu.stanford.irt.laneweb.servlet.binding.RemoteProxyIPDataBinder">
        <property name="proxyLinks" ref="edu.stanford.irt.laneweb.servlet.binding.ProxyLinks"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/template"
        class="edu.stanford.irt.laneweb.servlet.binding.TemplateDataBinder">
        <constructor-arg ref="edu.stanford.irt.laneweb.servlet.binding.TemplateChooser"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/emrid"
        class="edu.stanford.irt.laneweb.servlet.binding.StringSessionParameterDataBinder">
        <constructor-arg value="emrid"/>
        <constructor-arg value="emrid"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/request-parameter"
        class="edu.stanford.irt.laneweb.servlet.binding.RequestParameterDataBinder"/>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/request-method"
        class="edu.stanford.irt.laneweb.servlet.binding.RequestMethodDataBinder"/>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/request-header"
        class="edu.stanford.irt.laneweb.servlet.binding.RequestHeaderDataBinder"/>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/user-cookie"
        class="edu.stanford.irt.laneweb.servlet.binding.LoginExpirationCookieDataBinder"/>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/base-path"
        class="edu.stanford.irt.laneweb.servlet.binding.BasePathDataBinder">
        <constructor-arg ref="servletContext"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/content-base"
        class="edu.stanford.irt.laneweb.servlet.binding.ContentBaseDataBinder">
        <constructor-arg value="%{edu.stanford.irt.laneweb.live-base}"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/version"
        class="edu.stanford.irt.laneweb.servlet.binding.VersionDataBinder">
        <constructor-arg ref="servletContext"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/disaster-mode"
        class="edu.stanford.irt.laneweb.servlet.binding.DisasterModeDataBinder">
        <constructor-arg value="%{edu.stanford.irt.laneweb.disaster-mode}"/>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/live-chat-schedule"
        class="edu.stanford.irt.laneweb.servlet.binding.LiveChatScheduleBinder"/>

    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/todays-hours"
        class="edu.stanford.irt.laneweb.servlet.binding.TodaysHoursBinder">
        <constructor-arg>
            <bean class="edu.stanford.irt.laneweb.hours.TodaysHours">
                <constructor-arg value="%{edu.stanford.irt.laneweb.live-base}/includes/hours.xml"/>
            </bean>
        </constructor-arg>
    </bean>
    
    <bean name="edu.stanford.irt.laneweb.servlet.binding.DataBinder/parameter-map"
        class="edu.stanford.irt.laneweb.servlet.binding.ParameterMapDataBinder"/>

    <bean id="edu.stanford.irt.laneweb.servlet.binding.ProxyLinks"
        class="edu.stanford.irt.laneweb.servlet.binding.ProxyLinks">
        <!-- regular expressions for IPs to be proxied TODO: change to CIDRRanges -->
        <constructor-arg>
            <list>
                <!-- VPN 171.66.16.0 - 171.66.31.255 -->
                <value>^171\.66\.(?:1[6-9]|2[0-9]|3[0-1])\.\S+</value>
                <!-- hospital 171.65.44.0 - 171.65.44.255 -->
                <value>^171\.65\.44\.\S+</value>
                <!-- hospital 171.65.125.0 - 171.65.125.255 -->
                <value>^171\.65\.125\.\S+</value>
                <!-- hospital 171.65.128.0 - 171.65.199.255 -->
                <value>^171\.65\.1(?:2[8-9]|[3-9][0-9])\.\S+</value>
                <!-- hospital 171.65.200.0 - 171.65.255.255 -->
                <value>^171\.65\.2[0-5][0-9]\.\S+</value>
            </list>
        </constructor-arg>
        <!-- regular expressions for IPs to NOT be proxied -->
        <constructor-arg>
            <list>
                <value>^171\.6[4-7]\.\S+</value>
                <!-- campus wireless 10.32.0.0 through 10.33.255.255 -->
                <value>^10\.3[2-3]\.\S+</value>
                <!-- library wireless 10.39.32.1 through 10.39.47.255 -->
                <value>^10\.39\.(?:3[2-9]|4[0-7])\.\S+</value>
            </list>
        </constructor-arg>
    </bean>

    <bean id="edu.stanford.irt.laneweb.servlet.binding.TemplateChooser"
        class="edu.stanford.irt.laneweb.servlet.binding.TemplateChooser">
        <constructor-arg value="template"/>
        <constructor-arg>
            <list>
                <value>template</value>
                <value>bassettLargerView</value>
                <value>none</value>
            </list>
        </constructor-arg>
        <constructor-arg>
            <map>
                <entry key="^/biomed-resources/bassett/raw/bassettLargerView.html"
                    value="bassettLargerView"/>
                <entry key="^/discoveryLoginPage.html" value="none"/>
                <entry key="^/help/live-chat-only.html" value="none"/>
            </map>
        </constructor-arg>
    </bean>
    
    <bean id="edu.stanford.irt.laneweb.codec.UserCookieCodec"
        class="edu.stanford.irt.laneweb.codec.UserCookieCodec">
        <constructor-arg value="%{edu.stanford.irt.laneweb.useridcookiecodec.key}"/>
    </bean>

</beans>

<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.2.xsd">
    
    <import resource="bassett.xml"/>
    <import resource="binding.xml"/>
    <import resource="bookmarks.xml"/>
    <import resource="cme.xml"/>
    <import resource="datasources.xml"/>
    <import resource="eresources.xml"/>
    <import resource="grandrounds.xml"/>
    <import resource="mapping.xml"/>
    <import resource="pipeline.xml"/>
    <import resource="proxy.xml"/>
    <import resource="querymap.xml"/>
    <import resource="redirect.xml"/>
    <import resource="search.xml"/>
    <import resource="search-image.xml"/>
    <import resource="sitemap.xml"/>
    <import resource="source.xml"/>
    <import resource="suggest.xml"/>
    <import resource="trends.xml"/>
    <import resource="voyager-login.xml"/>
    <import resource="applications.xmap"/>
    <import resource="bookmarks.xmap"/>
    <import resource="classes.xmap"/>
    <import resource="content.xmap"/>
    <import resource="eresources.xmap"/>
    <import resource="mobile.xmap"/>
    <import resource="rss.xmap"/>
    <import resource="sitemap.xmap"/>
    
    <bean id="edu.stanford.irt.laneweb.user.LDAPDataAccess"
        class="edu.stanford.irt.laneweb.user.LDAPDataAccess">
        <constructor-arg>
            <bean class="org.springframework.ldap.core.LdapTemplate">
                <constructor-arg>
                    <bean class="org.springframework.ldap.core.support.LdapContextSource">
                        <property name="url" value="ldap://ldap.stanford.edu/"/>
                        <property name="base" value="cn=people,dc=stanford,dc=edu"/>
                        <property name="authenticationStrategy">
                            <bean class="edu.stanford.irt.laneweb.user.GSSAPIAuthenticationStrategy"
                            />
                        </property>
                        <property name="baseEnvironmentProperties">
                            <map>
                                <entry key="com.sun.jndi.ldap.connect.timeout" value="5000"/>
                            </map>
                        </property>
                    </bean>
                </constructor-arg>
            </bean>
        </constructor-arg>
        <constructor-arg ref="edu.stanford.irt.laneweb.user.SubjectSource"/>
        <constructor-arg>
            <set>
                <value>stanford:affiliate:sponsored</value>
                <value>stanford:faculty*</value>
                <value>stanford:faculty:onleave</value>
                <value>stanford:faculty:otherteaching</value>
                <value>stanford:faculty:slac</value>
                <value>stanford:faculty</value>
                <value>stanford:faculty:affiliate</value>
                <value>stanford:faculty:emeritus</value>
                <value>stanford:faculty:retired</value>
                <value>stanford:staff*</value>
                <value>stanford:staff</value>
                <value>stanford:staff:academic</value>
                <value>stanford:faculty:onleave</value>
                <value>stanford:staff:emeritus</value>
                <value>stanford:staff:otherteaching</value>
                <value>stanford:staff:temporary</value>
                <value>stanford:staff:casual</value>
                <value>stanford:student*</value>
                <value>stanford:student</value>
                <value>stanford:student:onleave</value>
                <value>stanford:student:postdoc</value>
                <value>stanford:student:mla</value>
                <value>stanford:student:ndo</value>
                <value>sumc:staff</value>
            </set>
        </constructor-arg>
    </bean>
    
    <bean class="edu.stanford.irt.laneweb.email.EMailSender">
        <constructor-arg>
            <bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
                <property name="host" value="medmail.stanford.edu"/>
            </bean>
        </constructor-arg>
        <constructor-arg>
            <bean class="edu.stanford.irt.laneweb.email.SpamFilter">
                <constructor-arg>
                    <set>
                        <value>lane-issue@med.stanford.edu</value>
                        <value>LaneAskUs@stanford.edu</value>
                        <value>lanelibacqs@lists.stanford.edu</value>
                        <value>docxpress@lists.stanford.edu</value>
                    </set>
                </constructor-arg>
                <constructor-arg>
                    <set>
                        <value>173.44.37.242</value>
                        <value>96.47.224.218</value>
                        <value>192.119.144.96</value>
                        <value>192.119.151.127</value>
                        <value>178.32.54.240</value>
                        <value>178.150.15.201</value>
                        <value>37.57.231.135</value>
                    </set>
                </constructor-arg>
                <constructor-arg>
                    <set>
                        <value>http://lane.stanford.edu/dept/anthropology/cgi-bin/web/index.html?q=user</value>
                        <value>http://lane.stanford.edu/dept/anthropology/cgi-bin/web/index.html?q=user/register</value>
                    </set>
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="edu.stanford.irt.laneweb.user.SubjectSource"
          class="edu.stanford.irt.laneweb.user.SubjectSource">
        <constructor-arg value="IRT_K5"/>
    </bean>
    
    <bean class="edu.stanford.irt.spell.PubmedESpellChecker"/>
    
    <bean name="edu.stanford.irt.cocoon.xml.SAXParser/xml"
        class="edu.stanford.irt.cocoon.xml.JaxpSAXParser">
        <constructor-arg ref="javax.xml.parsers.SAXParserFactory"/>
    </bean>
    
    <bean name="edu.stanford.irt.cocoon.xml.SAXParser/html"
        class="edu.stanford.irt.laneweb.cocoon.HTMLSAXParser"
        scope="prototype">
        <constructor-arg>
            <bean class="edu.stanford.irt.laneweb.cocoon.NekoHTMLConfiguration">
                <constructor-arg>
                    <map>
                        <entry key="http://cyberneko.org/html/properties/default-encoding" value="UTF-8"/>
                        <entry key="http://cyberneko.org/html/properties/names/elems" value="lower"/>
                        <entry key="http://cyberneko.org/html/properties/namespaces-uri" value="http://www.w3.org/1999/xhtml"/>
                    </map>
                </constructor-arg>
                <constructor-arg>
                    <map>
                        <entry key="http://cyberneko.org/html/features/insert-namespaces" value="true"/>
                    </map>
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>
    
    <bean name="edu.stanford.irt.cocoon.xml.SAXParser/html-fragment"
        class="edu.stanford.irt.laneweb.cocoon.HTMLSAXParser"
        scope="prototype">
        <constructor-arg>
            <bean class="edu.stanford.irt.laneweb.cocoon.NekoHTMLConfiguration">
                <constructor-arg>
                    <map>
                        <entry key="http://cyberneko.org/html/properties/default-encoding" value="UTF-8"/>
                        <entry key="http://cyberneko.org/html/properties/names/elems" value="lower"/>
                        <entry key="http://cyberneko.org/html/properties/namespaces-uri" value="http://www.w3.org/1999/xhtml"/>
                    </map>
                </constructor-arg>
                <constructor-arg>
                    <map>
                        <entry key="http://cyberneko.org/html/features/insert-namespaces" value="true"/>
                        <entry key="http://cyberneko.org/html/features/balance-tags/document-fragment" value="true"/>
                    </map>
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>
    
    <bean id="edu.stanford.irt.cocoon.cache.Cache"
        class="edu.stanford.irt.laneweb.cocoon.EHCache">
        <constructor-arg>
            <bean class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean"/>
        </constructor-arg>
    </bean>
    
    <bean id="edu.stanford.irt.cocoon.Model"
        class="java.util.HashMap"
        scope="request">
    </bean>
    
    <bean name="javax.xml.parsers.DocumentBuilderFactory"
        class="edu.stanford.irt.cocoon.spring.DocumentBuilderFactoryBean">
        <constructor-arg value="org.apache.xerces.jaxp.DocumentBuilderFactoryImpl"/>
        <property name="coalescing" value="false"/>
        <property name="expandEntityReferences" value="true"/>
        <property name="ignoringComments" value="false"/>
        <property name="ignoringElementContentWhitespace" value="false"/>
        <property name="namespaceAware" value="true"/>
        <property name="validating" value="false"/>
        <property name="XIncludeAware" value="false"/>
        <property name="features">
            <map>           
                <entry key="http://apache.org/xml/features/nonvalidating/load-external-dtd" value="false"/>
            </map>
        </property>
    </bean>
    
    <bean name="javax.xml.parsers.SAXParserFactory"
        class="edu.stanford.irt.cocoon.spring.SAXParserFactoryBean">
        <constructor-arg value="org.apache.xerces.jaxp.SAXParserFactoryImpl"/>
        <property name="namespaceAware" value="true"/>
        <property name="validating" value="false"/>
        <property name="XIncludeAware" value="false"/>
        <property name="features">
            <map>
                <entry key="http://apache.org/xml/features/nonvalidating/load-external-dtd" value="false"/>
            </map>
        </property>
    </bean>
    
    <bean name="javax.xml.transform.sax.SAXTransformerFactory/saxon"
        class="edu.stanford.irt.cocoon.spring.SAXTransformerFactoryBean">
        <constructor-arg value="net.sf.saxon.TransformerFactoryImpl"/>
    </bean>
    
    <bean name="javax.xml.transform.sax.SAXTransformerFactory/joost"
        class="edu.stanford.irt.cocoon.spring.SAXTransformerFactoryBean">
        <constructor-arg value="net.sf.joost.trax.TransformerFactoryImpl"/>
    </bean>
    
    <bean name="javax.xml.transform.TransformerFactory"
        class="edu.stanford.irt.cocoon.spring.TransformerFactoryBean">
        <constructor-arg value="net.sf.saxon.TransformerFactoryImpl"/>
    </bean>
    
    <bean name="javax.xml.xpath.XPathFactory"
        class="edu.stanford.irt.cocoon.spring.XPathFactoryBean">
        <constructor-arg value="com.sun.org.apache.xpath.internal.jaxp.XPathFactoryImpl"/>
    </bean>
    
    <bean name="edu.stanford.irt.cocoon.xml.TransformerHandlerFactory/saxon"
        class="edu.stanford.irt.cocoon.xml.TransformerHandlerFactory">
        <constructor-arg ref="javax.xml.transform.sax.SAXTransformerFactory/saxon"/>
        <constructor-arg ref="javax.xml.transform.URIResolver"/>
        <constructor-arg ref="javax.xml.transform.ErrorListener"/>
    </bean>
    
    <bean name="edu.stanford.irt.cocoon.xml.TransformerHandlerFactory/joost"
        class="edu.stanford.irt.cocoon.xml.TransformerHandlerFactory">
        <constructor-arg ref="javax.xml.transform.sax.SAXTransformerFactory/joost"/>
        <constructor-arg ref="javax.xml.transform.URIResolver"/>
        <constructor-arg ref="javax.xml.transform.ErrorListener"/>
    </bean>
    
    <bean id="javax.xml.transform.URIResolver"
        class="edu.stanford.irt.cocoon.xml.URIResolverImpl">
        <constructor-arg ref="edu.stanford.irt.cocoon.source.SourceResolver"/>
    </bean>
    
    <bean name="javax.xml.transform.ErrorListener"
        class="edu.stanford.irt.laneweb.cocoon.TransformerErrorListener"/>
    
    <bean id="org.springframework.oxm.Marshaller"
        class="org.springframework.oxm.xstream.XStreamMarshaller">
        <property name="aliases">
            <map>
                <!--<entry key="eresource" value="edu.stanford.irt.eresources.EresourceImpl"/>
                <entry key="seresource" value="edu.stanford.irt.eresources.impl.SearchEresourceImpl"/>
                <entry key="link" value="edu.stanford.irt.eresources.LinkImpl"/>
                <entry key="paging" value="edu.stanford.irt.laneweb.eresources.PagingData"/>
                <entry key="region" value="edu.stanford.irt.laneweb.bassett.RegionCount"/>
                <entry key="bassett" value="edu.stanford.irt.laneweb.bassett.BassettImage"/>
                <entry key="mresource" value="edu.stanford.irt.search.impl.ContentResult"/>
                <entry key="result" value="edu.stanford.irt.search.impl.Result"/>-->
                <entry key="bookmark" value="edu.stanford.irt.laneweb.bookmarks.Bookmark"/>
                <entry key="facet" value="edu.stanford.irt.laneweb.solr.Facet"/>
            </map>
        </property>
        <!-- setMode(XStream.NO_REFERENCES) -->
        <property name="mode" value="1001"/>
    </bean>
    
    <bean id="edu.stanford.irt.cocoon.sitemap.ComponentFactory"
        class="edu.stanford.irt.cocoon.spring.SpringComponentFactory"/>
    
    <bean id="edu.stanford.irt.cocoon.xml.XPointerProcessor"
        class="edu.stanford.irt.cocoon.xml.xpointer.XPointerProcessorImpl">
        <constructor-arg ref="edu.stanford.irt.cocoon.xml.SAXParser/xml"/>
        <constructor-arg ref="javax.xml.xpath.XPathFactory"/>
        <constructor-arg ref="javax.xml.parsers.DocumentBuilderFactory"/>
        <constructor-arg ref="javax.xml.transform.TransformerFactory"/>
    </bean>
    
    <bean name="edu.stanford.irt.cocoon.xml.XIncludePipe"
        class="edu.stanford.irt.cocoon.xml.XIncludePipe"
        scope="prototype">
        <constructor-arg ref="edu.stanford.irt.cocoon.source.SourceResolver"/>
        <constructor-arg ref="edu.stanford.irt.cocoon.xml.SAXParser/xml"/>
        <constructor-arg>
            <bean class="edu.stanford.irt.laneweb.cocoon.XIncludeExceptionListenerImpl"/>
        </constructor-arg>
        <constructor-arg ref="edu.stanford.irt.cocoon.xml.XPointerProcessor"/>
    </bean>
    
    <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <!-- change from default because of maven filter properties seen as properties in dev environment -->
        <property name="placeholderPrefix" value="%{"></property>
    </bean>
    
    <bean id="edu.stanford.irt.laneweb.codec.SHCCodec"
        class="edu.stanford.irt.laneweb.codec.SHCCodec">
        <constructor-arg value="%{edu.stanford.irt.laneweb.shccodec.key}"/>
        <constructor-arg value="%{edu.stanford.irt.laneweb.shccodec.vector}"/>
    </bean>
    
    <bean id="messageSource"
        class="org.springframework.context.support.DelegatingMessageSource"/>
    
    <bean id="lifecycleProcessor"
        class="org.springframework.context.support.DefaultLifecycleProcessor"/>
    
    <bean id="applicationEventMulticaster"
        class="org.springframework.context.event.SimpleApplicationEventMulticaster"/>
    
    <bean  id="themeSource"
        class="org.springframework.ui.context.support.DelegatingThemeSource"/>
    
</beans>
